---
import type { GetStaticPaths, Page } from 'astro';
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';
import BlogCard from '@components/blog/BlogCard.astro';
import Pagination from '@components/ui/Pagination.astro';
import BaseLayout from '@layouts/BaseLayout.astro';

type BlogPost = CollectionEntry<'blog'>;

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const posts = await getCollection('blog', ({ data }) => (import.meta.env.PROD ? !data.draft : true));
  const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
  return paginate(sortedPosts, { pageSize: 6 });
};

const { page } = Astro.props as { page: Page<BlogPost> };
---

<BaseLayout title={`Archive ${page.currentPage} | Signal & Sprocket`} description="記事のページネーション一覧です。">
  <section class="mb-8 flex items-end justify-between gap-4">
    <div>
      <h1 class="text-4xl">Archive</h1>
      <p class="mt-3 text-sm opacity-80">ページ {page.currentPage} / {page.lastPage}</p>
    </div>
    <a href="/blog/" class="btn-outline">一覧表示に戻る</a>
  </section>

  <div class="grid gap-6 md:grid-cols-2 xl:grid-cols-3">
    {page.data.map((post) => <BlogCard post={post} />)}
  </div>

  <Pagination
    currentPage={page.currentPage}
    lastPage={page.lastPage}
    prevUrl={page.url.prev ?? undefined}
    nextUrl={page.url.next ?? undefined}
  />
</BaseLayout>
