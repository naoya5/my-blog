<div class="card-surface p-6">
  <h2 class="text-sm font-bold uppercase tracking-widest text-slate-400 mb-4">Search</h2>
  <div id="search" class="min-h-[40px]" data-search-status="loading"></div>
  <p id="search-fallback" class="mt-3 hidden text-sm text-rose-500" role="status">
    検索を読み込めませんでした。時間をおいて再度お試しください。
  </p>
</div>

<link href="/pagefind/pagefind-ui.css" rel="stylesheet" />
<style is:global>
  :root {
    --pagefind-ui-primary: rgb(14 165 233);
    --pagefind-ui-text: rgb(15 23 42);
    --pagefind-ui-background: transparent;
    --pagefind-ui-border: rgb(226 232 240);
    --pagefind-ui-tag: rgb(241 245 249);
    --pagefind-ui-border-radius: 12px;
  }

  html.dark {
    --pagefind-ui-primary: rgb(56 189 248);
    --pagefind-ui-text: rgb(241 245 249);
    --pagefind-ui-border: rgb(31 41 55);
    --pagefind-ui-tag: rgb(31 41 55);
  }

  .pagefind-ui__search-input {
    @apply font-sans !important;
  }
</style>
<script src="/pagefind/pagefind-ui.js" is:inline></script>
<script is:inline>
  function showSearchError(host, fallback, reason) {
    host.setAttribute('data-search-status', 'error');
    fallback?.classList.remove('hidden');
    console.warn('[search] Pagefind initialization failed:', reason);
  }

  function mountPagefind() {
    const host = document.querySelector('#search');
    const fallback = document.querySelector('#search-fallback');
    if (!host || host.getAttribute('data-bound') === '1') return;
    if (!window.PagefindUI) {
      showSearchError(host, fallback, 'window.PagefindUI is unavailable');
      return;
    }

    host.setAttribute('data-bound', '1');
    host.setAttribute('data-search-status', 'ready');
    fallback?.classList.add('hidden');
    new window.PagefindUI({
      element: '#search',
      showSubResults: true,
      showImages: false,
      translations: {
        placeholder: '記事を検索...',
      },
    });
  }

  mountPagefind();
  document.addEventListener('astro:after-swap', mountPagefind);
</script>
